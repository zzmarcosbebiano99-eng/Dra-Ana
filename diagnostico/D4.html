<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Questionário de Diagnóstico por Imagem</title>
<style>
  :root{
    --bg:#f5f6fa;
    --card:#ffffff;
    --muted:#777;
    --accent:#007bff;
    --green:#28a745;
    --red:#dc3545;
    --green-bg:#d4edda;
    --red-bg:#f8d7da;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg);
    display: flex;
    justify-content: center;
    padding: 50px 16px;
  }

  .quiz-container {
    width: 680px;
    max-width: 95%;
    background: var(--card);
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(15,20,30,0.06);
    padding: 30px;
  }

  .quiz-header { margin-bottom: 18px; }
  .quiz-header h1 { font-size: 22px; margin-bottom: 4px; }
  .quiz-header p { color: var(--muted); font-size: 13px; margin: 0; }

  .question { margin: 18px 0; font-weight: 600; font-size: 18px; }
  .options { list-style: none; padding: 0; margin: 0; }

  .option {
    background: #fbfcfd;
    margin-bottom: 12px;
    padding: 12px 15px;
    border-radius: 10px;
    cursor: pointer;
    transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    border: 1px solid rgba(15,20,30,0.04);
  }

  .option:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 18px rgba(15,20,30,0.04);
    background: #f4f7fb;
  }

  .option.selected {
    background: linear-gradient(180deg,#eef5ff, #f6fbff);
    box-shadow: 0 0 0 3px rgba(0,123,255,0.08) inset;
    outline: none;
  }

  .option.correct {
    background: linear-gradient(180deg, #eef9f0, #f7fcf8);
    border-left: 6px solid var(--green);
    border-color: rgba(40,167,69,0.14);
  }

  .option.incorrect {
    background: linear-gradient(180deg, #fff5f6, #fff8f9);
    border-left: 6px solid var(--red);
    border-color: rgba(220,53,69,0.08);
    opacity: 0.98;
  }

  .feedback {
    margin-top: 16px;
    font-size: 15px;
    padding: 14px 16px;
    border-radius: 10px;
    display: none;
    align-items: flex-start;
    gap: 12px;
    box-shadow: 0 6px 18px rgba(15,20,30,0.03);
  }

  .feedback .icon { font-size: 20px; margin-top: 2px; }
  .feedback.correct { background: var(--green-bg); color: #155724; border-left: 6px solid var(--green); }
  .feedback.incorrect { background: var(--red-bg); color: #721c24; border-left: 6px solid var(--red); }

  .explanation { margin-top: 10px; font-size: 14px; color: #222; line-height: 1.4; background: rgba(0,0,0,0.01); padding: 10px; border-radius: 8px; }

  .btn-row { display:flex; gap:12px; margin-top: 18px; align-items:center; }
  .btn { padding: 11px 20px; border: none; border-radius: 9px; background-color: var(--accent); color: white; cursor: pointer; font-size: 15px; transition: background .12s ease, transform .08s; }
  .btn:hover { transform: translateY(-2px); background-color: #0056b3; }
  .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
  .btn-secondary { background: #6c757d; }
  .btn-back { background: #000; color: #fff; }

  .gabarito { margin-top: 20px; }
  .gabarito h2 { margin: 0 0 12px 0; font-size: 20px; }
  .g-item { border-radius: 10px; padding: 12px; margin-bottom: 12px; background: #fbfcfd; border: 1px solid rgba(15,20,30,0.04); }
  .g-item .meta { font-size: 14px; margin-bottom: 8px; }
  .g-item .meta .you { font-weight: 600; }
  .answer-correct { color: var(--green); font-weight:700; }
  .answer-wrong { color: var(--red); font-weight:700; }

  @media (max-width:480px){ .quiz-container { padding: 18px; } .question { font-size:16px; } }
</style>
</head>
<body>
  <div class="quiz-container" role="application" aria-label="Questionário de Diagnóstico por Imagem">
    <div class="quiz-header">
      <h1></h1>
      <p>Coração (Ecocardiografia) / Fígado</p>
    </div>

    <div class="question" id="questionText"></div>
    <ul class="options" id="optionsList" aria-live="polite"></ul>

    <div class="feedback" id="feedbackBox" role="status" aria-hidden="true">
      <div class="icon" id="feedbackIcon">✔️</div>
      <div>
        <div id="feedbackTitle" style="font-weight:700"></div>
        <div class="explanation" id="feedbackExplanation"></div>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-confirm" id="btnConfirm">Confirmar Resposta</button>
      <button class="btn btn-next" id="btnNext" style="display:none;">Próxima Questão</button>
      <button class="btn btn-secondary" id="btnRestart" style="display:none;">Refazer</button>
    </div>

    <div class="gabarito" id="gabaritoEl" style="display:none;"></div>
  </div>

<script>
const quizId = 'D4'; // Identificador único deste quiz

const quiz = [
  {
    "q": "Qual tipo de transdutor é mais adequado para exames ecocardiográficos em pequenos animais devido à necessidade de uma pequena pegada e maior resolução temporal?",
    "options": [
      "A) Sondas lineares de alta frequência.",
      "B) Sondas curvilíneas de baixa frequência.",
      "C) Transdutores setoriais ou de varredura curvilínea com tecnologia Phased Array.",
      "D) Transdutores macroconvexos."
    ],
    "answer": 2,
    "explanation": "Os exames ecocardiográficos são mais bem executados usando transdutores setoriais ou de varredura curvilínea, preferencialmente com tecnologia Phased Array."
  },
  {
    "q": "Qual método ecocardiográfico proporciona a máxima resolução temporal e é frequentemente utilizado para quantificação ventricular?",
    "options": [
      "A) Doppler de Fluxo de Cores (CFD)",
      "B) Imagem Bidimensional (2DE)",
      "C) Modo de Movimento (Modo M)",
      "D) Doppler de Onda Contínua (CWD)"
    ],
    "answer": 2,
    "explanation": "A resolução temporal máxima é obtida usando a ecocardiografia em modo de movimento (modo M)."
  },
  {
    "q": "Em um animal normal, qual é o padrão característico do sinal de ejeção aórtica registrado por Doppler Pulsado (PWD)?",
    "options": [
      "A) Pico de velocidade tardio com longa duração de ejeção.",
      "B) Pico de velocidade no início do ciclo de ejeção, conferindo uma forma de punhal ao envelope de velocidade.",
      "C) Velocidade máxima sempre superior à da ejeção pulmonar.",
      "D) Um envelope de velocidade preenchido (alargamento espectral)."
    ],
    "answer": 1,
    "explanation": "O sinal de ejeção aórtica normal atinge o pico no início do ciclo de ejeção e pode conferir uma forma de punhal ao envelope de velocidade."
  },
  {
    "q": "Na avaliação da regurgitação mitral (RM) pelo método PISA, qual é o princípio subjacente usado para estimar a taxa de fluxo regurgitante?",
    "options": [
      "A) O volume regurgitante é calculado pela velocidade máxima.",
      "B) A taxa de fluxo sanguíneo é aproximada pelo produto da velocidade do sangue e a área do hemisfério da zona de convergência de fluxo.",
      "C) O raio do hemisfério é dividido pelo tempo de desaceleração.",
      "D) O PISA mede o volume sistólico total do VE."
    ],
    "answer": 1,
    "explanation": "O método PISA assume que a taxa de fluxo sanguíneo instantâneo é o produto da velocidade do sangue naquele raio e a área do hemisfério, A=2πr²."
  },
  {
    "q": "A Cardiopatia Hipertrófica (CMH) em gatos é tipicamente sugerida por qual achado no Modo M?",
    "options": [
      "A) Aumento acentuado da LVIDd.",
      "B) Espessura da parede do VE na diástole (DVE) superior a 0,60 cm.",
      "C) Diminuição do Ponto Final para Distância de Separação Septal (EPSS).",
      "D) Diminuição do espessamento do Septo Interventricular (IVS)."
    ],
    "answer": 1,
    "explanation": "A espessura da parede do VE na diástole (DVE) é normalmente menor que 0,55 cm, e valores maiores que 0,60 cm são sugestivos de hipertrofia."
  },
  {
    "q": "Qual achado ecocardiográfico, quando presente em cães com Estenose Pulmonar (EP), está associado a um pior prognóstico?",
    "options": [
      "A) Pressão de enchimento normal do VE.",
      "B) Gradiente de pressão através da EP inferior a 50 mmHg.",
      "C) Gradiente de pressão através da EP superior a 60 mmHg ou Regurgitação Tricúspide significativa.",
      "D) Função ventricular esquerda preservada."
    ],
    "answer": 2,
    "explanation": "Regurgitação tricúspide significativa, bem como um gradiente de pressão através do PS (EP) de mais de 60 mmHg podem estar associados a um pior resultado em cães com EP."
  },
  {
    "q": "Qual é a principal indicação para Pericardiocentese (PC)?",
    "options": [
      "A) Confirmação do diagnóstico de neoplasia cardíaca.",
      "B) Obtenção de amostra de efusão para cultura.",
      "C) Derrame pericárdico (EP) associado a sinais clínicos por compressão cardíaca (tamponamento).",
      "D) Prevenção de arritmias ventriculares."
    ],
    "answer": 2,
    "explanation": "O derrame pericárdico (EP) associado a sinais clínicos por compressão cardíaca (tamponamento) é a principal indicação para PC."
  },
  {
    "q": "Qual é a ecogenicidade relativa do fígado, em comparação com o baço e o córtex renal, em cães e gatos normais?",
    "options": [
      "A) O fígado é tipicamente hiperecogênico em relação a ambos.",
      "B) O fígado é tipicamente hipoecóico em relação ao baço e o córtex renal é frequentemente hiperecogênico ao fígado.",
      "C) O fígado é sempre anecóico em comparação com o córtex renal.",
      "D) O fígado e o baço são sempre isoecóicos."
    ],
    "answer": 1,
    "explanation": "O baço é relativamente hiperecogênico em relação ao fígado. O córtex renal é frequentemente hiperecogênico em cães e gatos normais e pode se tornar isoecogênico para o fígado."
  },
  {
    "q": "Qual achado ultrassonográfico difuso é sugestivo de lipidose hepática (fígado gorduroso)?",
    "options": [
      "A) Fígado difusamente hipoecóico.",
      "B) Fígado difusamente hiperecóico, frequentemente isoecóico ao baço.",
      "C) Múltiplos nódulos hipoecóicos bem definidos.",
      "D) Fígado de ecotextura grossa com realce acústico distal."
    ],
    "answer": 1,
    "explanation": "A lipidose hepática causa um fígado difusamente hiperecóico, frequentemente isoecoico ao baço."
  },
  {
    "q": "Qual é o achado ecográfico indicativo de obstrução biliar completa e prolongada?",
    "options": [
      "A) Sinal de sombra acústica distal à vesícula biliar.",
      "B) O sinal de 'muitos tubos' (ductos hepáticos dilatados) no parênquima.",
      "C) Diminuição do diâmetro do ducto biliar comum (CBD).",
      "D) Hipertrofia do lobo caudado."
    ],
    "answer": 1,
    "explanation": "Tubos anecóicos irregulares e tortuosos com paredes hiperecogênicas, conhecidos como o sinal de 'muitos tubos', geralmente indicam obstrução biliar completa."
  },
  {
    "q": "Na avaliação de shunts portossistêmicos (PSS) extra-hepáticos, qual razão de diâmetro luminal (veia porta principal / aorta) em cães é altamente preditiva de sua presença?",
    "options": [
      "A) Uma razão ≥ 1,0",
      "B) Uma razão ≤ 0,65",
      "C) Uma razão ≤ 0,8",
      "D) Uma razão 0,8 a 1,2"
    ],
    "answer": 1,
    "explanation": "Uma razão PV-aorta ≤ 0,65 prediz a presença de um shunt extra-hepático."
  },
  {
    "q": "Qual é o achado ultrassonográfico focal mais comum no fígado de cães, responsável por muitas lesões focais identificadas, que tende a aparecer como nódulos hipoecóicos?",
    "options": [
      "A) Carcinoma hepatocelular",
      "B) Hiperplasia nodular benigna",
      "C) Linfoma metastático",
      "D) Cistos hepáticos"
    ],
    "answer": 1,
    "explanation": "A hiperplasia nodular benigna é comum, particularmente em cães, e é responsável por muitas lesões hepáticas focais, tendendo a aparecer como nódulos hipoecóicos."
  }
];

let currentQuestion = 0;
let selectedOption = null;
let locked = false;
let userAnswers = [];

const questionEl = document.getElementById('questionText');
const optionsEl = document.getElementById('optionsList');
const feedbackEl = document.getElementById('feedbackBox');
const feedbackTitle = document.getElementById('feedbackTitle');
const feedbackIcon = document.getElementById('feedbackIcon');
const feedbackExplanation = document.getElementById('feedbackExplanation');
const btnConfirm = document.getElementById('btnConfirm');
const btnNext = document.getElementById('btnNext');
const btnRestart = document.getElementById('btnRestart');
const gabaritoEl = document.getElementById('gabaritoEl');

function loadQuestion() {
  locked = false;
  selectedOption = null;
  const q = quiz[currentQuestion];
  questionEl.textContent = `Q${currentQuestion+1}. ${q.q}`;
  optionsEl.innerHTML = '';
  feedbackEl.style.display = 'none';
  feedbackEl.setAttribute('aria-hidden','true');
  btnConfirm.style.display = 'inline-block';
  btnNext.style.display = 'none';
  btnRestart.style.display = 'none';

  q.options.forEach((opt,index)=>{
    const li = document.createElement('li');
    li.className = 'option';
    li.tabIndex = 0;
    li.setAttribute('role','button');
    li.setAttribute('data-index', index);
    li.innerHTML = `<span style="flex:1">${opt}</span>`;
    const onSelect = ()=>{
      if(locked) return;
      optionsEl.querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));
      li.classList.add('selected');
      selectedOption = index;
    };
    li.addEventListener('click',onSelect);
    li.addEventListener('keydown',(e)=>{
      if(e.key==='Enter'||e.key===' '){ e.preventDefault(); onSelect(); }
    });
    optionsEl.appendChild(li);
  });

  if(typeof userAnswers[currentQuestion]!=='undefined'&&userAnswers[currentQuestion]!==null){
    const pre = userAnswers[currentQuestion];
    const preLi = optionsEl.querySelector(`.option[data-index="${pre}"]`);
    if(preLi) preLi.classList.add('selected');
    selectedOption = pre;
  }
}

btnConfirm.addEventListener('click',()=>{
  if(selectedOption===null){
    btnConfirm.animate([{ transform: 'translateY(0)' }, { transform: 'translateY(-4px)' }, { transform: 'translateY(0)' }], { duration: 220 });
    return;
  }
  locked=true;
  const correctIndex = quiz[currentQuestion].answer;
  const optionsLi = optionsEl.querySelectorAll('.option');

  optionsLi.forEach((li,index)=>{
    li.classList.remove('selected');
    if(index===correctIndex) li.classList.add('correct');
    if(index===selectedOption && index!==correctIndex) li.classList.add('incorrect');
    li.style.pointerEvents='none';
  });

  userAnswers[currentQuestion] = selectedOption;

  if(selectedOption===correctIndex){
    feedbackTitle.textContent='Correto!';
    feedbackIcon.textContent='✔️';
    feedbackEl.className='feedback correct';
  }else{
    feedbackTitle.textContent='Incorreto';
    feedbackIcon.textContent='❌';
    feedbackEl.className='feedback incorrect';
  }

  feedbackExplanation.innerHTML=`<strong>Por que:</strong> ${quiz[currentQuestion].explanation}`;

  feedbackEl.style.display='flex';
  feedbackEl.setAttribute('aria-hidden','false');

  btnConfirm.style.display='none';
  if(currentQuestion<quiz.length-1){
    btnNext.style.display='inline-block';
  }else{
    btnNext.textContent='Ver Gabarito';
    btnNext.style.display='inline-block';
  }
});

btnNext.addEventListener('click',()=>{
  currentQuestion++;
  if(currentQuestion<quiz.length){
    loadQuestion();
    btnNext.textContent='Próxima Questão';
  }else{
    showGabarito();
  }
});

btnRestart.addEventListener('click',()=>{
  currentQuestion=0;
  userAnswers=[];
  btnNext.textContent='Próxima Questão';
  questionEl.style.display='';
  optionsEl.style.display='';
  feedbackEl.style.display='none';
  gabaritoEl.style.display='none';
  loadQuestion();
});

function showGabarito(){
  questionEl.style.display='none';
  optionsEl.style.display='none';
  feedbackEl.style.display='none';
  btnConfirm.style.display='none';
  btnNext.style.display='none';

  gabaritoEl.style.display='block';
  gabaritoEl.innerHTML='<h2>Gabarito e explicações</h2>';

  // **SALVA PONTUAÇÃO NO LOCALSTORAGE**
  let correctCount = userAnswers.reduce((acc,ans,idx)=> acc + (ans===quiz[idx].answer?1:0),0);
  let percent = Math.round((correctCount/quiz.length)*100);
  localStorage.setItem('score_'+quizId, percent);

  quiz.forEach((q,i)=>{
    const div=document.createElement('div');
    div.className='g-item';
    const userIdx = typeof userAnswers[i]!=='undefined'?userAnswers[i]:null;
    const correctIdx = q.answer;
    const userText = userIdx===null?'Não respondeu':q.options[userIdx];
    const correctText = q.options[correctIdx];
    const ok = userIdx===correctIdx;
    const status = ok?`<span class="answer-correct">✔ Correta</span>`:`<span class="answer-wrong">✖ Incorreta</span>`;
    div.innerHTML=`
      <div class="meta"><strong>Q${i+1}.</strong> ${q.q}</div>
      <div><span class="you">Sua resposta:</span> ${userText} ${userIdx!==null?'&nbsp;•&nbsp;'+status:''}</div>
      <div><strong>Resposta correta:</strong> <span class="answer-correct">${correctText}</span></div>
      <div class="explanation" style="margin-top:8px"><strong>Explicação:</strong> ${q.explanation}</div>
    `;
    gabaritoEl.appendChild(div);
  });

  const backRow=document.createElement('div');
  backRow.style.marginTop='14px';
  backRow.style.display='flex';
  backRow.style.gap='10px';

  const btnVoltar=document.createElement('button');
  btnVoltar.className='btn btn-back';
  btnVoltar.textContent='Voltar';
  btnVoltar.title='Voltar (history.back())';
  btnVoltar.addEventListener('click',()=>{
    if(window.history.length>1) window.history.back();
    else window.location.href='#';
  });

  const btnRefazer=document.createElement('button');
  btnRefazer.className='btn';
  btnRefazer.textContent='Refazer Quiz';
  btnRefazer.addEventListener('click',()=>{
    currentQuestion=0;
    userAnswers=[];
    gabaritoEl.style.display='none';
    questionEl.style.display='';
    optionsEl.style.display='';
    loadQuestion();
  });

  backRow.appendChild(btnVoltar);
  backRow.appendChild(btnRefazer);
  gabaritoEl.appendChild(backRow);
}

loadQuestion();
</script>
</body>
</html>
