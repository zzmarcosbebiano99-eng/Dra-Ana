<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Questionário de Cirurgia</title>
<style>
  :root{
    --bg:#f5f6fa;
    --card:#ffffff;
    --muted:#777;
    --accent:#007bff;
    --green:#28a745;
    --red:#dc3545;
    --green-bg:#d4edda;
    --red-bg:#f8d7da;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg);
    display: flex;
    justify-content: center;
    padding: 50px 16px;
  }

  .quiz-container {
    width: 680px;
    max-width: 95%;
    background: var(--card);
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(15,20,30,0.06);
    padding: 30px;
  }

  .quiz-header { margin-bottom: 18px; }
  .quiz-header h1 { font-size: 22px; margin-bottom: 4px; }
  .quiz-header p { color: var(--muted); font-size: 13px; margin: 0; }

  .question { margin: 18px 0; font-weight: 600; font-size: 18px; }
  .options { list-style: none; padding: 0; margin: 0; }

  .option {
    background: #fbfcfd;
    margin-bottom: 12px;
    padding: 12px 15px;
    border-radius: 10px;
    cursor: pointer;
    transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    border: 1px solid rgba(15,20,30,0.04);
  }

  .option:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 18px rgba(15,20,30,0.04);
    background: #f4f7fb;
  }

  .option.selected {
    background: linear-gradient(180deg,#eef5ff, #f6fbff);
    box-shadow: 0 0 0 3px rgba(0,123,255,0.08) inset;
    outline: none;
  }

  .option.correct {
    background: linear-gradient(180deg, #eef9f0, #f7fcf8);
    border-left: 6px solid var(--green);
    border-color: rgba(40,167,69,0.14);
  }

  .option.incorrect {
    background: linear-gradient(180deg, #fff5f6, #fff8f9);
    border-left: 6px solid var(--red);
    border-color: rgba(220,53,69,0.08);
    opacity: 0.98;
  }

  .feedback {
    margin-top: 16px;
    font-size: 15px;
    padding: 14px 16px;
    border-radius: 10px;
    display: none;
    align-items: flex-start;
    gap: 12px;
    box-shadow: 0 6px 18px rgba(15,20,30,0.03);
  }

  .feedback .icon { font-size: 20px; margin-top: 2px; }
  .feedback.correct { background: var(--green-bg); color: #155724; border-left: 6px solid var(--green); }
  .feedback.incorrect { background: var(--red-bg); color: #721c24; border-left: 6px solid var(--red); }

  .explanation { margin-top: 10px; font-size: 14px; color: #222; line-height: 1.4; background: rgba(0,0,0,0.01); padding: 10px; border-radius: 8px; }

  .btn-row { display:flex; gap:12px; margin-top: 18px; align-items:center; }
  .btn { padding: 11px 20px; border: none; border-radius: 9px; background-color: var(--accent); color: white; cursor: pointer; font-size: 15px; transition: background .12s ease, transform .08s; }
  .btn:hover { transform: translateY(-2px); background-color: #0056b3; }
  .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
  .btn-secondary { background: #6c757d; }
  .btn-back { background: #000; color: #fff; }

  .gabarito { margin-top: 20px; }
  .gabarito h2 { margin: 0 0 12px 0; font-size: 20px; }
  .g-item { border-radius: 10px; padding: 12px; margin-bottom: 12px; background: #fbfcfd; border: 1px solid rgba(15,20,30,0.04); }
  .g-item .meta { font-size: 14px; margin-bottom: 8px; }
  .g-item .meta .you { font-weight: 600; }
  .answer-correct { color: var(--green); font-weight:700; }
  .answer-wrong { color: var(--red); font-weight:700; }

  @media (max-width:480px){ .quiz-container { padding: 18px; } .question { font-size:16px; } }
</style>
</head>
<body>
  <div class="quiz-container" role="application" aria-label="Questionário de Anestesia">
    <div class="quiz-header">
      <h1></h1>
      <p>Ortopedia e Fixação (Técnicas e Princípios)</p>
    </div>

    <div class="question" id="questionText"></div>
    <ul class="options" id="optionsList" aria-live="polite"></ul>

    <div class="feedback" id="feedbackBox" role="status" aria-hidden="true">
      <div class="icon" id="feedbackIcon">✔️</div>
      <div>
        <div id="feedbackTitle" style="font-weight:700"></div>
        <div class="explanation" id="feedbackExplanation"></div>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-confirm" id="btnConfirm">Confirmar Resposta</button>
      <button class="btn btn-next" id="btnNext" style="display:none;">Próxima Questão</button>
      <button class="btn btn-secondary" id="btnRestart" style="display:none;">Refazer</button>
    </div>

    <div class="gabarito" id="gabaritoEl" style="display:none;"></div>
  </div>

<script>
const quizId = 'q3'; // Identificador único deste quiz

const quiz = [
  {
    "q": "Qual é o princípio orientador na redução fechada de fraturas?",
    "options": [
      "A) Aplicação de tração e rotação bruscas.",
      "B) Aplicação de tração lenta e contínua.",
      "C) Alavancagem interna dos fragmentos.",
      "D) Imobilização imediata sem tração."
    ],
    "answer": 1,
    "explanation": "O princípio orientador é aplicar tração lenta e contínua ao fragmento controlável. A tração lenta e progressiva ao longo de 10 a 30 minutos é a melhor forma de relaxar a musculatura."
  },
  {
    "q": "Para máxima rigidez de um fixador esquelético externo unilateral (Tipo IA), qual é o ângulo ideal de inserção dos pinos em relação ao longo eixo do osso?",
    "options": [
      "A) 90 graus.",
      "B) 70 graus.",
      "C) 45 graus.",
      "D) 30 graus."
    ],
    "answer": 1,
    "explanation": "Os pinos de fixação devem ser inseridos em um ângulo de 70 graus em relação ao longo eixo do osso para fornecer máxima rigidez ao fixador."
  },
  {
    "q": "Qual é o conceito que permite o aumento da carga compressiva na fratura, frequentemente implementado cerca de 6 semanas após a cirurgia em FEE?",
    "options": [
      "A) Neutralização.",
      "B) Dinamização.",
      "C) Compressão.",
      "D) Uso de pinos de perfil positivo."
    ],
    "answer": 1,
    "explanation": "A dinamização é alcançada removendo barras ou pinos para permitir maior carga compressiva. O momento ideal para dinamização de fraturas em cães é de cerca de 6 semanas após a cirurgia."
  },
  {
    "q": "Qual é a principal característica que confere estabilidade a uma Placa de Compressão Dinâmica (DCP)?",
    "options": [
      "A) O uso de parafusos de travamento no osso.",
      "B) A compressão da placa ao osso com a fricção resultante.",
      "C) O preenchimento do canal medular com o pino IM.",
      "D) A neutralização das forças rotacionais sem contato ósseo."
    ],
    "answer": 1,
    "explanation": "A estabilidade da DCP é criada pela compressão da placa ao osso com a fricção resultante entre as superfícies de contato."
  },
  {
    "q": "Qual é o critério obrigatório para que um arame de cerclagem produza compressão interfragmentar em uma fratura oblíqua?",
    "options": [
      "A) Fratura deve ser do tipo C complexa.",
      "B) O comprimento da linha de fratura deve ser igual a pelo menos duas vezes o diâmetro do osso.",
      "C) O arame deve ser de laço duplo (double-loop).",
      "D) O arame deve ser colocado a intervalos de 5 mm."
    ],
    "answer": 1,
    "explanation": "Para que a compressão seja produzida por um arame de cerclagem, o comprimento da linha de fratura oblíqua deve ser igual a pelo menos duas vezes o diâmetro do osso."
  },
  {
    "q": "Ao usar pinos de rosca de perfil positivo (raised-thread), qual técnica deve ser usada para evitar microfraturas do córtex?",
    "options": [
      "A) Pré-perfuração de um orifício piloto 10% menor que o diâmetro do pino.",
      "B) Inserção com broca de alta velocidade.",
      "C) Inserção em um ângulo de 70 graus.",
      "D) Uso de martelo cirúrgico para assentamento."
    ],
    "answer": 0,
    "explanation": "O dano (microfraturas) causado pela inserção direta de pinos de rosca de perfil positivo pode ser reduzido pré-perfurando um orifício piloto no osso que seja 10% menor que o diâmetro do pino."
  },
  {
    "q": "Qual fixação é ideal para fraturas por avulsão, permitindo que as forças de flexão sejam convertidas em forças de compressão?",
    "options": [
      "A) Placa de Compressão Dinâmica (DCP).",
      "B) Arame de Banda de Tensão (Tension Band).",
      "C) Parafuso de sustentação (Lag Screw).",
      "D) Pino Intramedular (IM pin)."
    ],
    "answer": 1,
    "explanation": "A fixação por arame de banda de tensão é ideal porque permite que as forças de flexão (ou tração) sejam convertidas em forças de compressão."
  },
  {
    "q": "Qual o sinal de alerta de movimento excessivo que pode ser visto radiograficamente em uma fratura tratada com fixação rígida (primária)?",
    "options": [
      "A) Formação de união direta haversiana.",
      "B) Reabsorção óssea no local da fratura.",
      "C) Desenvolvimento de um calo de irritação (cloudy callus).",
      "D) Osteoporose por desuso."
    ],
    "answer": 2,
    "explanation": "O desenvolvimento de um calo de irritação ('cloudy callus') é um sinal de alerta e indica algum movimento ocorrendo no local da fratura e o potencial para união tardia ou não-união."
  },
  {
    "q": "O que deve ser feito com o orifício no primeiro córtex (fragmento proximal) para que um parafuso cortical funcione como um parafuso de compressão (lag screw)?",
    "options": [
      "A) Deve ser igual ao diâmetro externo da rosca do parafuso (orifício deslizante).",
      "B) Deve ser igual ao diâmetro do núcleo da rosca.",
      "C) Deve ser rosqueado (tapped).",
      "D) Deve ser 10% menor que o diâmetro externo da rosca."
    ],
    "answer": 0,
    "explanation": "Para que funcione como lag screw, o orifício no primeiro córtex deve ser igual ao diâmetro externo das roscas do parafuso (orifício deslizante), permitindo que o parafuso deslize e puxe o fragmento."
  },
  {
    "q": "Qual é a principal limitação dos pinos de Steinmann (IM pins) quando usados como fixação única?",
    "options": [
      "A) São muito caros para uso rotineiro.",
      "B) Requerem fixação auxiliar para neutralizar forças rotacionais.",
      "C) Causam trauma na placa de crescimento.",
      "D) São difíceis de remover."
    ],
    "answer": 1,
    "explanation": "O pino de Steinmann não é eficaz na neutralização de forças rotacionais e compressivas/de cisalhamento e geralmente requer fixação auxiliar."
  }
];


let currentQuestion = 0;
let selectedOption = null;
let locked = false;
let userAnswers = [];

const questionEl = document.getElementById('questionText');
const optionsEl = document.getElementById('optionsList');
const feedbackEl = document.getElementById('feedbackBox');
const feedbackTitle = document.getElementById('feedbackTitle');
const feedbackIcon = document.getElementById('feedbackIcon');
const feedbackExplanation = document.getElementById('feedbackExplanation');
const btnConfirm = document.getElementById('btnConfirm');
const btnNext = document.getElementById('btnNext');
const btnRestart = document.getElementById('btnRestart');
const gabaritoEl = document.getElementById('gabaritoEl');

function loadQuestion() {
  locked = false;
  selectedOption = null;
  const q = quiz[currentQuestion];
  questionEl.textContent = `Q${currentQuestion+1}. ${q.q}`;
  optionsEl.innerHTML = '';
  feedbackEl.style.display = 'none';
  feedbackEl.setAttribute('aria-hidden','true');
  btnConfirm.style.display = 'inline-block';
  btnNext.style.display = 'none';
  btnRestart.style.display = 'none';

  q.options.forEach((opt,index)=>{
    const li = document.createElement('li');
    li.className = 'option';
    li.tabIndex = 0;
    li.setAttribute('role','button');
    li.setAttribute('data-index', index);
    li.innerHTML = `<span style="flex:1">${opt}</span>`;
    const onSelect = ()=>{
      if(locked) return;
      optionsEl.querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));
      li.classList.add('selected');
      selectedOption = index;
    };
    li.addEventListener('click',onSelect);
    li.addEventListener('keydown',(e)=>{
      if(e.key==='Enter'||e.key===' '){ e.preventDefault(); onSelect(); }
    });
    optionsEl.appendChild(li);
  });

  if(typeof userAnswers[currentQuestion]!=='undefined'&&userAnswers[currentQuestion]!==null){
    const pre = userAnswers[currentQuestion];
    const preLi = optionsEl.querySelector(`.option[data-index="${pre}"]`);
    if(preLi) preLi.classList.add('selected');
    selectedOption = pre;
  }
}

btnConfirm.addEventListener('click',()=>{
  if(selectedOption===null){
    btnConfirm.animate([{ transform: 'translateY(0)' }, { transform: 'translateY(-4px)' }, { transform: 'translateY(0)' }], { duration: 220 });
    return;
  }
  locked=true;
  const correctIndex = quiz[currentQuestion].answer;
  const optionsLi = optionsEl.querySelectorAll('.option');

  optionsLi.forEach((li,index)=>{
    li.classList.remove('selected');
    if(index===correctIndex) li.classList.add('correct');
    if(index===selectedOption && index!==correctIndex) li.classList.add('incorrect');
    li.style.pointerEvents='none';
  });

  userAnswers[currentQuestion] = selectedOption;

  if(selectedOption===correctIndex){
    feedbackTitle.textContent='Correto!';
    feedbackIcon.textContent='✔️';
    feedbackEl.className='feedback correct';
  }else{
    feedbackTitle.textContent='Incorreto';
    feedbackIcon.textContent='❌';
    feedbackEl.className='feedback incorrect';
  }

  feedbackExplanation.innerHTML=`<strong>Por que:</strong> ${quiz[currentQuestion].explanation}`;

  feedbackEl.style.display='flex';
  feedbackEl.setAttribute('aria-hidden','false');

  btnConfirm.style.display='none';
  if(currentQuestion<quiz.length-1){
    btnNext.style.display='inline-block';
  }else{
    btnNext.textContent='Ver Gabarito';
    btnNext.style.display='inline-block';
  }
});

btnNext.addEventListener('click',()=>{
  currentQuestion++;
  if(currentQuestion<quiz.length){
    loadQuestion();
    btnNext.textContent='Próxima Questão';
  }else{
    showGabarito();
  }
});

btnRestart.addEventListener('click',()=>{
  currentQuestion=0;
  userAnswers=[];
  btnNext.textContent='Próxima Questão';
  questionEl.style.display='';
  optionsEl.style.display='';
  feedbackEl.style.display='none';
  gabaritoEl.style.display='none';
  loadQuestion();
});

function showGabarito(){
  questionEl.style.display='none';
  optionsEl.style.display='none';
  feedbackEl.style.display='none';
  btnConfirm.style.display='none';
  btnNext.style.display='none';

  gabaritoEl.style.display='block';
  gabaritoEl.innerHTML='<h2>Gabarito e explicações</h2>';

  // **SALVA PONTUAÇÃO NO LOCALSTORAGE**
  let correctCount = userAnswers.reduce((acc,ans,idx)=> acc + (ans===quiz[idx].answer?1:0),0);
  let percent = Math.round((correctCount/quiz.length)*100);
  localStorage.setItem('score_'+quizId, percent);

  quiz.forEach((q,i)=>{
    const div=document.createElement('div');
    div.className='g-item';
    const userIdx = typeof userAnswers[i]!=='undefined'?userAnswers[i]:null;
    const correctIdx = q.answer;
    const userText = userIdx===null?'Não respondeu':q.options[userIdx];
    const correctText = q.options[correctIdx];
    const ok = userIdx===correctIdx;
    const status = ok?`<span class="answer-correct">✔ Correta</span>`:`<span class="answer-wrong">✖ Incorreta</span>`;
    div.innerHTML=`
      <div class="meta"><strong>Q${i+1}.</strong> ${q.q}</div>
      <div><span class="you">Sua resposta:</span> ${userText} ${userIdx!==null?'&nbsp;•&nbsp;'+status:''}</div>
      <div><strong>Resposta correta:</strong> <span class="answer-correct">${correctText}</span></div>
      <div class="explanation" style="margin-top:8px"><strong>Explicação:</strong> ${q.explanation}</div>
    `;
    gabaritoEl.appendChild(div);
  });

  const backRow=document.createElement('div');
  backRow.style.marginTop='14px';
  backRow.style.display='flex';
  backRow.style.gap='10px';

  const btnVoltar=document.createElement('button');
  btnVoltar.className='btn btn-back';
  btnVoltar.textContent='Voltar';
  btnVoltar.title='Voltar (history.back())';
  btnVoltar.addEventListener('click',()=>{
    if(window.history.length>1) window.history.back();
    else window.location.href='#';
  });

  const btnRefazer=document.createElement('button');
  btnRefazer.className='btn';
  btnRefazer.textContent='Refazer Quiz';
  btnRefazer.addEventListener('click',()=>{
    currentQuestion=0;
    userAnswers=[];
    gabaritoEl.style.display='none';
    questionEl.style.display='';
    optionsEl.style.display='';
    loadQuestion();
  });

  backRow.appendChild(btnVoltar);
  backRow.appendChild(btnRefazer);
  gabaritoEl.appendChild(backRow);
}

loadQuestion();
</script>
</body>
</html>
